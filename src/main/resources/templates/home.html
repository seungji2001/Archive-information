<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .103_19 {
            overflow:hidden;
        }
        .e103_19 {
            width:1903px;
            height:936px;
            position:absolute;
        }
        .e103_8 {
            background-color:rgba(203.90047878026962, 205.06250202655792, 190.5372342467308, 1);
            width:1903px;
            height:936px;
            position:absolute;
            left:4px;
            top:1px;
        }
        .e103_9 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:176px;
            height:61px;
            position:absolute;
            left:25px;
            top:25px;
            border-top-left-radius:20px;
            border-top-right-radius:20px;
            border-bottom-left-radius:20px;
            border-bottom-right-radius:20px;
        }
        .103_9 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e103_12 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:176px;
            height:61px;
            position:absolute;
            left:285px;
            top:25px;
            border-top-left-radius:20px;
            border-top-right-radius:20px;
            border-bottom-left-radius:20px;
            border-bottom-right-radius:20px;
        }
        .103_12 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e103_10 {
            color:rgba(0, 0, 0, 1);
            width:200px;
            height:24px;
            position:absolute;
            left:46px;
            top:43px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }
        .e103_13 {
            color:rgba(0, 0, 0, 1);
            width:117px;
            height:24px;
            position:absolute;
            left:315px;
            top:43px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }
        .e103_14 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:436px;
            height:798px;
            position:absolute;
            left:25px;
            top:106px;
        }

        .e104_2 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:176px;
            height:61px;
            position:absolute;
            left:155px;
            top:131px;
            border-top-left-radius:20px;
            border-top-right-radius:20px;
            border-bottom-left-radius:20px;
            border-bottom-right-radius:20px;
        }
        .104_2 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e104_3 {
            color:rgba(0, 0, 0, 1);
            width:117px;
            height:24px;
            position:absolute;
            left:185px;
            top:149px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }
        .e103_8 {
            background-color:rgba(203.90047878026962, 205.06250202655792, 190.5372342467308, 1);
            width:1903px;
            height:936px;
            position:absolute;
            left:4px;
            top:1px;
        }
        .e103_9 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:176px;
            height:61px;
            position:absolute;
            left:25px;
            top:25px;
            border-top-left-radius:20px;
            border-top-right-radius:20px;
            border-bottom-left-radius:20px;
            border-bottom-right-radius:20px;
        }
        .103_9 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e103_12 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:176px;
            height:61px;
            position:absolute;
            left:285px;
            top:25px;
            border-top-left-radius:20px;
            border-top-right-radius:20px;
            border-bottom-left-radius:20px;
            border-bottom-right-radius:20px;
        }
        .103_12 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e103_10 {
            color:rgba(0, 0, 0, 1);
            width:135px;
            height:24px;
            position:absolute;
            left:46px;
            top:43px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }
        .e103_13 {
            color:rgba(0, 0, 0, 1);
            width:117px;
            height:24px;
            position:absolute;
            left:315px;
            top:43px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }
        .e103_14 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:436px;
            height:798px;
            position:absolute;
            left:25px;
            top:106px;
        }
        .e104_2 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:176px;
            height:61px;
            position:absolute;
            left:155px;
            top:131px;
            border-top-left-radius:20px;
            border-top-right-radius:20px;
            border-bottom-left-radius:20px;
            border-bottom-right-radius:20px;
        }
        .104_2 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e104_3 {
            color:rgba(0, 0, 0, 1);
            width:117px;
            height:24px;
            position:absolute;
            left:185px;
            top:149px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }

        .e108_4 {
            color:rgba(0, 0, 0, 1);
            width:405px;
            height:651px;
            position:absolute;
            left:42px;
            top:236px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }

        .e109_5 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:431px;
            height:693px;
            position:absolute;
            left:492px;
            top:211px;
        }
        .109_5 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e109_6 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:431px;
            height:83px;
            position:absolute;
            left:492px;
            top:109px;
        }
        .109_6 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e109_8 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:83px;
            height:52px;
            position:absolute;
            left:823px;
            top:121px;
        }
        .109_8 {
                border:1px solid rgba(0, 0, 0, 1);
            }
        .e109_10 {
            color:rgba(0, 0, 0, 1);
            width:37px;
            height:24px;
            position:absolute;
            left:846px;
            top:137px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }
        .e109_11 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            color:rgba(0, 0, 0, 1);
            width:298px;
            height:49px;
            position:absolute;
            left:508px;
            top:124px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }
        .e115_4 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:176px;
            height:61px;
            position:absolute;
            left:960px;
            top:25px;
            border-radius: 20px;
        }
        .e115_5 {
            color:rgba(0, 0, 0, 1);
            width:122px;
            height:24px;
            position:absolute;
            left:987px;
            top:43px;
            font-family:Inter;
            text-align:left;
            font-size:20px;
            letter-spacing:0;
        }
        .e103_14 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:436px;
            height:798px;
            position:absolute;
            left:25px;
            top:106px;
        }
        .e115_8 {
            width:447px;
            height:795px;
            position:absolute;
            left:960px;
            top:106px;
        }
        .e115_6 {
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:448px;
            height:795px;
            position:absolute;
            left:-1px;
            top:0px;
            overflow: scroll;
        }
        .e115_9 {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px;
            box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);
            background-color:rgba(217.0000022649765, 217.0000022649765, 217.0000022649765, 1);
            width:423px;
            height:80px;
            position:flex;
            left:2px;
            top:0px;
            overflow: hidden;
        }
        .link_text{
            font-size: 20px;
        }
        .findOnGoogle{
            display: flex;
            align-items: center;
            justify-self: center;
            width: 300px;
            height: 60px;
            flex-shrink: 0;
            margin: 10px;
            border: 1px solid #000;
            background: #D9D9D9;
            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
        }
        .buttonOnGoogle{
            display: flex;
            align-items: center;
            justify-self: center;
            width: 83px;
            height: 60px;
            flex-shrink: 0;
            margin: 10px;
            border: 1px solid #000;
            background: #D9D9D9;
            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
        }
        .searchbox{
            display: flex;
            align-items: center;
        }
        .MemoBox{
            width: 448px;
            height: 795px;
            flex-shrink: 0;
            border: 1px solid #000;
            right: 22px;
            top:105px;
            background: #D9D9D9;
            position: absolute;
            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
        }
    </style>
    <!--    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.8.10/tailwind.min.css'>-->
    <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>

        function uploadFile() {
            var inputFile = document.getElementById("input-file");
            var file = inputFile.files[0];

            var formData = new FormData();
            formData.append("file", file);

            fetch("/upload", {
                method: "POST",
                body: formData
            })
                .then(function (response) {
                    if (response.ok) {
                        alert("File uploaded successfully");
                    } else {
                        alert("Error uploading file");
                    }
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
        function getTextFromFile(){
            var inputFile = document.getElementById("input-file");
            var file = inputFile.files[0];
            var dataRecognized;

            var jsonData = {
                filename: file.name
            };
            fetch("/recording", {
                method: "POST",
                body: JSON.stringify(jsonData),
                headers: {
                    "Content-Type": "application/json"
                }
            })
                .then(function(response) {
                    if (response.ok) {
                        return response.json();
                    } else {
                        alert("Error uploading file");
                    }
                })
                .then(function(data) {
                    console.log(data)
                    // $('.audioFileNumber').val(data)
                    dataRecognized = data.recognized
                    var contentData = {
                        content:data.recognized
                    }
                    console.log(contentData)
                    return fetch("/nelinking", {
                        method: "POST",
                        body: JSON.stringify(contentData),
                        headers: {
                            "Content-Type": "application/json"
                        }
                    });
                })
                .then(function(response) {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error("Error sending another API request");
                    }
                })
                .then(function(data) {
                    console.log(data); // Access the JSON response data from the second API request
                    console.log(dataRecognized)

                    var newDataRecognized = dataRecognized
                    data.forEach(data => {
                        const replaceRegex = new RegExp(data.mention, "g");
                        if(data.url === "")
                            newDataRecognized = newDataRecognized.replaceAll(replaceRegex, `<a style="color:blue" class="dataPointed">${data.mention}</a>`);
                        else
                            newDataRecognized = newDataRecognized.replaceAll(replaceRegex, `<a href="${data.url}" target="_blank" class="dataPointed">${data.mention}</a>`);
                    });

                    console.log(newDataRecognized)

                    // for (let i = 0; i < data.length; i++){
                    //     let word = data[i].mention
                    //     let url = data[i].url
                    //     let s_pos = data[i].s_pos
                    //     let def = data[i].definition
                    //
                    //     dataRecognized.slice()
                    // }

                    var element = document.querySelector(".e108_4");
                    if (element) {
                        // Set the inner text of the element
                        element.innerHTML = newDataRecognized;
                    }
                })
                .catch(function(error) {
                    console.error(error);
                });
        }
        function askQuestionBaseOnTextFile() {
            var question = document.querySelector('.e109_11').value
            var sentence = document.querySelector(".e108_4").innerHTML
            console.log(sentence)
            var jsonData = {
                question: question,
                content:sentence
            }
            fetch("/question", {
                method: "POST",
                body: JSON.stringify(jsonData),
                headers: {
                    "Content-Type": "application/json"
                }
            })
                .then(function (response) {
                    if (response.ok) {
                        return response.json()
                    } else {
                        alert('Error sending another API request')
                    }
                })
                .then(function(data) {
                    console.log(data); // Access the JSON response data from the second API request
                    var element = document.querySelector(".e109_5");
                    if (element) {
                        // Set the inner text of the element
                        element.innerHTML = data.answer;
                    }
                })
                .catch(function(error) {
                    console.error(error);
                });

        }
        function findRelativeLink(){
            console.log(document.getElementsByClassName('dataPointed'))
            var elements = document.getElementsByClassName('dataPointed')
            var dataList = []
            for (let i = 0; i < elements.length; i++) {
                var innerText = elements[i].innerText;
                const jsonObject = {
                    data: innerText
                };
                dataList.push(jsonObject);
            }
            var json = {
                relativeData : dataList
            }

            fetch("/search/relativeData", {
                method: "POST",
                body: JSON.stringify(json),
                headers: {
                    "Content-Type": "application/json"
                }
            })
                .then(function (response) {
                    if (response.ok) {
                        return response.json()
                    } else {
                        alert('Error sending another API request')
                    }
                })
                .then(function(data) {
                    console.log(data); // Access the JSON response data from the second API request
                    for (let i = 0; i < data.length; i++) {
                        var divBox = document.createElement("div");
                        divBox.classList.add("e115_9");
                        var a_link = document.createElement("a");
                        a_link.classList.add("link_text")
                        a_link.setAttribute("target", "_blank");
                        a_link.href = data[i].link;
                        a_link.innerText = data[i].title;
                        divBox.append(a_link)
                        document.querySelector(".e115_6").appendChild(divBox);
                    }

                    // if (element) {
                    //     // Set the inner text of the element
                    //     element.innerText = data.answer;
                    // }
                })
                .catch(function(error) {
                    console.error(error);
                });
        }
        function buttonOnGoogle(){
            var data = document.querySelector(".findOnGoogle").value
            console.log(data)
            var jsonData = {
                data: data
            }
            console.log(jsonData)
            fetch("/search", {
                method: "POST",
                body: JSON.stringify(jsonData),
                headers: {
                    "Content-Type": "application/json"
                }
            })
                .then(function (response) {
                    if (response.ok) {
                        return response.json()
                    } else {
                        alert('Error sending another API request')
                    }
                })
                .then(function(data) {
                    console.log(data); // Access the JSON response data from the second API request
                    for (let i = 0; i < data.length; i++) {
                        var divBox = document.createElement("div");
                        divBox.classList.add("e115_9");
                        var a_link = document.createElement("a");
                        a_link.setAttribute("target", "_blank");
                        a_link.classList.add("link_text")
                        a_link.href = data[i].link;
                        a_link.innerText = data[i].title;
                        divBox.append(a_link)
                        document.querySelector(".e115_6").appendChild(divBox);
                    }

                    // if (element) {
                    //     // Set the inner text of the element
                    //     element.innerText = data.answer;
                    // }
                })
                .catch(function(error) {
                    console.error(error);
                });
        }
    </script>
</head>
<body>
<div class=e103_19>
    <div class="e103_8"></div>
    <div class="e103_9"></div>
    <div class="e103_12"></div>
    <input id="input-file" class="e103_10" type="file" name="file"/>
    <button class="e103_13" onclick="uploadFile()" type="submit">
        Upload
    </button>
    <input type="hidden" class="audioFileNumber">
    <div class="e103_14"></div>
    <div class="e104_2" onclick="getTextFromFile()"></div><span  class="e104_3">텍스트로 반환</span>
    <span  class="e108_4"></span>
    <div class="e109_5"></div>
    <div class="e109_6"></div>
    <div class="e109_8"></div><span  class="e109_10" onclick="askQuestionBaseOnTextFile()">질문</span>
    <input type="text" class="e109_11" placeholder="질문하기">
    <div class="e115_4" onclick="findRelativeLink()"></div><span  class="e115_5">관련 자료 찾기</span>
    <div class=e115_8>
        <div class="e115_6">
            <div class="searchbox">
                <input type="text" class="findOnGoogle" placeholder="google에 물어보세요">
                <div class="buttonOnGoogle" onclick="buttonOnGoogle()"><p>검색</p></div>
            </div>
        </div>
    </div>
    <textarea class="MemoBox">
    </textarea>
    </div>
</div>
</body>
</html>